[EN](README.md) | RU

### Описание
Докер-контейнер, содержащий в себе подготовленное окружение для Web-приложений на основе Nginx и PHP-FPM с интегрированными функциями Cron и мониторинга через Nginx Amplify. Существует минималистичная вариация `core` без PHP-FPM для работы в роли Reverse Proxy или раздачи статического контента.

Есть несколько доступных веток, отличающихся наличием/отсутствием php-fpm и его версией:
````
core
5.6
7.0
7.1
7.2
7.3
7.4
8.0
````
В случае использование внешней папки с файлами проекта, они должны быть примонтированны в контейнер по пути `/www`.


### Опции контейнера
Для любых из веток имеется возможность тонкой настройки и включения доп.опций, управляемых через ENV-переменные или монтирование внешних файлов

##### Amplify
````
AMPLIFY_TAG=""
AMPLIFY_HOST=""
AMPLIFY_UUID=""
AMPLIFY_NAME=""
AMPLIFY_KEY=""
````
Указание параметров для запуска в контейнере Amplify-агента. 

Параметр **AMPLIFY_TAG** используется для именования конфиг-файлов в самом контейнере, что помогает найти конкретный контейнер в списке элементов системы в интерфейсе Amplify, отличив его от других.

Параметр **AMPLIFY_UUID** не являются обязательными, при его отсутствии Amplify-агент сгенерирует его самостоятельно.

##### Модули NGINX
Контейнер поставляется со скомпилированным модулем NGINX для поддержки `GeoIP2` баз от MaxMind, модуль включается автоматически при нахождении внутри контейнера файла по необходимому пути:
````
/etc/nginx/data/geo2.mmdb
````

Базы GeoIP2 от MaxMind дают доступ к дополнителями заголовкам:
````
HTTP_GEOIP_LONGITUDE
HTTP_GEOIP_LATITUDE
HTTP_GEOIP_RADIUS
HTTP_GEOIP_TIMEZONE
HTTP_GEOIP_CITY_NAME
HTTP_GEOIP_REGION_NAME
HTTP_GEOIP_REGION_CODE
HTTP_GEOIP_COUNTRY_NAME
HTTP_GEOIP_COUNTRY_CODE
HTTP_GEOIP_CONTINENT_NAME
HTTP_GEOIP_CONTINENT_CODE
````


##### Настройка пользователя
Возможна настройка пользователя, из под которого будут выполняться процессы контейнера - что частично упрощает работу с внешними volume, подключенными к нему.

````
GID=33
UID=33
````
Параметры **UID** и **GID** указывают ID пользователя и группы, из под которого будут запущены процессы nginx и php-fpm.

##### Включение XDebug
Для активации модуля xdebug к php необходимо передать конфигурационную строчку в переменные окружения, пример:
````
XDEBUG_CONFIG=remote_host=172.17.0.1 remote_enable=1
````

### Тонкая настройка
Тонкая настройка достигается монтированием своих файлов на указанные пути внутри контейнера.

##### Настройка хостов Nginx
Для установка своих конфигураций хостов в Nginx, необходимо примонтировать папку с ними по пути `/etc/nginx/sites-available/`, подключение внешних ssl-сертификатов запроектировано на точку `/etc/nginx/ssl/certs`

##### Настройка пула PHP-FPM
Возможно применение дополнительных параметров к пулу PHP-FPM, используемого для веб-приложения, конфиг, примонтированны по пути `/etc/php/current/fpm/pool.conf` будет применён к настройкам пула и может использоваться для настройки воркеров
или других опций.

##### Правки к PHP.INI
Для указания своих настроек к `php.ini`, монтируется файл с правками по пути `/etc/php/current/fpm/conf.d/99-app.ini`
            
##### Свой Entrypoint
При необходимости возможно указать дополнительные команды, выполняемые при старте контейнера, в отдельном Entrypoint. Точка монтирования для bash-скрипта - `/entrypoint.sh`

##### Задания Cron
Для установки в контейнере заданий в crontab, используется отдельный файл с синтаксисом, аналогичным `crontab -e`, точка монтирования - `/crontab.txt`. Файл должен оканчиваться пустой строкой и используется для прямой загрузки в Crontab.


### Пример использования контейнера в рамках файла `docker-compose.yml`:
````
services:
  proxy:
    image:
      inspirium/nginx-pack:core
    container_name:
      core-proxy
    volumes:
      - ./sites:/etc/nginx/sites-available:ro
      - ./files:/www
    ports:
      - "80:80"
````
